<div class="max-w-7xl mx-auto">
  <!-- Add a form for search, per page, and filters -->
  <%= form_with url: events_path, method: :get, local: true, id: "event-search-form", class: "bg-white p-6 rounded-lg mb-8" do %>
    
    <!-- Search Input in One Row -->
    <div class="flex justify-between items-center gap-4 mb-6">
      <h1 class="text-3xl font-bold"><%= t('events.index_title') %></h1>
      <div class="flex items-center gap-2">
        <%= text_field_tag :search, params[:search], class: "w-64 px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8" %>
        <%= submit_tag t('events.search'), class: 'px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm h-8' %>
        <%= link_to t('events.clear_search'), events_path(category: params[:category], location: params[:location], min_price: params[:min_price], max_price: params[:max_price], start_date: params[:start_date], end_date: params[:end_date]), class: 'px-3 py-1 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm h-8' %>
      </div>
    </div>

    <!-- Filters in a Single Row -->
    <div class="flex flex-wrap items-end gap-4 mb-4">
      <div class="flex-1">
        <%= label_tag :per_page, t('events.per_page'), class: 'block font-semibold mb-1 text-sm' %>
        <%= select_tag :per_page, options_for_select([5, 10, 20, 50], selected: params[:per_page]), class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8", onchange: "document.getElementById('event-search-form').submit();" %>
      </div>

      <div class="flex-1">
        <%= label_tag :category, t('events.category'), class: 'block font-semibold mb-1 text-sm' %>
        <%= select_tag :category, options_for_select(Category.all.pluck(:name, :id), selected: params[:category]), include_blank: true, class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8", onchange: "document.getElementById('event-search-form').submit();" %>
      </div>

      <div class="flex-1">
        <%= label_tag :location, t('events.location'), class: 'block font-semibold mb-1 text-sm' %>
        <%= select_tag :location, options_for_select(Event.distinct.pluck(:location).compact, selected: params[:location]), include_blank: true, class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8", onchange: "document.getElementById('event-search-form').submit();" %>
      </div>

      <div class="flex-1 grid grid-cols-2 gap-4">
        <div>
          <%= label_tag :min_price, t('events.min_price'), class: 'block font-semibold mb-1 text-sm' %>
          <%= number_field_tag :min_price, params[:min_price], class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8" %>
        </div>

        <div>
          <%= label_tag :max_price, t('events.max_price'), class: 'block font-semibold mb-1 text-sm' %>
          <%= number_field_tag :max_price, params[:max_price], class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8" %>
        </div>
      </div>

      <div class="flex-1">
        <%= label_tag :start_date, t('events.start_date'), class: 'block font-semibold mb-1 text-sm' %>
        <%= date_field_tag :start_date, params[:start_date], class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8" %>
      </div>

      <div class="flex-1">
        <%= label_tag :end_date, t('events.end_date'), class: 'block font-semibold mb-1 text-sm' %>
        <%= date_field_tag :end_date, params[:end_date], class: "w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 text-sm h-8" %>
      </div>

      <!-- Apply Filters Button -->
      <div class="flex-1 flex justify-end space-x-2">
        <%= submit_tag t('events.apply_filters'), class: 'px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm h-8' %>
        <%= link_to t('events.clear_filters'), events_path(search: params[:search]), class: 'px-3 py-1 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 text-sm h-8' %>
      </div>
    </div>
  <% end %>

  <!-- Display Events -->
  <ul class="mt-8 space-y-6">
    <% @events.each do |event| %>
      <li class="bg-white p-6 rounded-lg shadow-md">
        <div class="mb-4">
          <h2 class="text-2xl font-semibold mb-2"><%= link_to event.name, event_path(event), class: "text-indigo-600 hover:underline" %></h2>
          <p class="text-lg font-semibold text-gray-700"><%= event.price == 0 ? t('events.free') : number_to_currency(event.price) %></p>
        </div>
        <p class="text-sm text-gray-600"><%= t('events.location') %>: <%= event.location %></p>
        <p class="text-sm text-gray-600 mb-4"><%= truncate(event.description, length: 35, separator: ' ') %></p>
        <p class="text-sm text-gray-600"><%= t('events.category') %>: <%= event.category.name %></p>
        <p class="text-sm text-gray-600"><%= t('events.date_and_time') %>: <%= event.starts_at.strftime("%b %d, %Y %I:%M %p") %></p>
      </li>
    <% end %>
  </ul>

  <!-- Pagination Links -->
  <div class="mt-8">
    <%= paginate @events, class: 'pagination' %>
  </div>
</div>
